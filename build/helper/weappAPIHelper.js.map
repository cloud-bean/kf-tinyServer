{"version":3,"sources":["../../src/helper/weappAPIHelper.js"],"names":["request","require","webapi","WeappAPI","constructor","appid","appSecret","accessToken","that","expireTime","getAccessToken","url","this","get","then","res","console","log","body","access_token","Date","getTime","expires_in","catch","err","isAccessTokenValid","preRequest","sendTemplate","toUser","templeteId","page","formId","templeteData","sendData","touser","template_id","form_id","data","post","send"],"mappings":"AAAA,MAAMA,UAAUC,QAAQ,YAAR,CAAhB;AACA,MAAMC,SAASD,QAAQ,qBAAR,EAA+BC,MAA9C;;AAEA,eAAe,MAAMC,QAAN,CAAe;AAC5BC,cAAYC,KAAZ,EAAmBC,SAAnB,EAA8B;AAC5B,SAAKD,KAAL,GAAaA,KAAb;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACAC,SAAKC,UAAL,GAAkB,EAAlB;AACD;AACDC,mBAAgB;AACd,UAAMF,OAAO,IAAb;AACA,UAAMG,MAAM,0EAAyE,SAAQ,KAAKN,KAAM,WAAU,KAAKO,IAAL,CAAUN,SAAU,EAAtI;AACAN,YACCa,GADD,CACKF,GADL,EAECG,IAFD,CAEOC,GAAD,IAAS;AACbC,cAAQC,GAAR,CAAYF,GAAZ;AACAP,WAAKD,WAAL,GAAmBQ,IAAIG,IAAJ,CAASC,YAA5B;AACAX,WAAKC,UAAL,GAAmB,IAAIW,IAAJ,GAAWC,OAAX,EAAD,GAAyB,CAACN,IAAIG,IAAJ,CAASI,UAAT,GAAsB,EAAvB,IAA6B,IAAxE;AACD,KAND,EAOCC,KAPD,CAOQC,GAAD,IAAS;AACdR,cAAQC,GAAR;AACD,KATD;AAUD;AACDQ,uBAAoB;AAClB,WAAO,CAAC,CAAC,KAAKlB,WAAP,IAAuB,IAAIa,IAAJ,GAAWC,OAAX,EAAD,GAAyB,KAAKZ,UAA3D;AACD;AACDiB,eAAY;AACV,QAAG,CAAC,KAAKD,kBAAL,EAAJ,EAA8B;AAC5B,aAAO,KAAKf,cAAL,EAAP;AACD,KAFD,MAEO;AACL;AACD;AACF;AACDiB,eAAaC,MAAb,EAAqBC,UAArB,EAAiCC,IAAjC,EAAuCC,MAAvC,EAA+CC,YAA/C,EAA4D;AAC1D,UAAMxB,OAAO,IAAb;AACE,WAAO,KAAKkB,UAAL,GACNZ,IADM,CACD,MAAI;AACR,YAAMH,MAAO,+EAA8EH,KAAKD,WAAY,EAA5G;AACA,YAAM0B,WAAW;AACfC,gBAAQN,MADO;AAEfO,qBAAaN,UAFE;AAGfC,cAAMA,IAHS;AAIfM,iBAASL,MAJM;AAKfM,cAAML;AALS,OAAjB;AAOAhC,cACCsC,IADD,CACM3B,GADN,EAEC4B,IAFD,CAEMN,QAFN,EAGCnB,IAHD,CAGOC,GAAD,IAAS;AACbC,gBAAQC,GAAR,CAAYF,GAAZ;AACD,OALD,EAMCQ,KAND,CAMQC,GAAD,IAAS;AACdR,gBAAQC,GAAR,CAAYO,GAAZ;AACD,OARD;AASD,KAnBM,CAAP;AAoBH;;AArD2B","file":"weappAPIHelper.js","sourcesContent":["const request = require('superagent');\nconst webapi = require('../config/wechatAPI').webapi;\n\nexport default class WeappAPI {\n  constructor(appid, appSecret) {\n    this.appid = appid;\n    this.appSecret = appSecret;\n    this.accessToken = '';\n    that.expireTime = '';\n  }\n  getAccessToken(){\n    const that = this;\n    const url = 'https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&'+`appid=${this.appid}&secret=${this.this.appSecret}`;\n    request\n    .get(url)\n    .then((res) => {\n      console.log(res);\n      that.accessToken = res.body.access_token;\n      that.expireTime = (new Date().getTime()) + (res.body.expires_in - 10) * 1000;\n    })\n    .catch((err) => {\n      console.log();\n    });\n  }\n  isAccessTokenValid(){\n    return !!this.accessToken && (new Date().getTime()) < this.expireTime;\n  }\n  preRequest(){\n    if(!this.isAccessTokenValid()){\n      return this.getAccessToken();\n    } else {\n      return;\n    }\n  }\n  sendTemplate(toUser, templeteId, page, formId, templeteData){\n    const that = this;\n      return this.preRequest()\n      .then(()=>{\n        const url = `https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send?access_token=${that.accessToken}`;\n        const sendData = {\n          touser: toUser,\n          template_id: templeteId,\n          page: page,\n          form_id: formId,\n          data: templeteData,\n        }\n        request\n        .post(url)\n        .send(sendData)\n        .then((res) => {\n          console.log(res);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n      });\n  }\n\n}\n"]}